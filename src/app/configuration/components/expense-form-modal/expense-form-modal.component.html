<div class="expense-form-modal">
  <h2 mat-dialog-title>
    <mat-icon>{{ data.isEditing ? 'edit' : 'add' }}</mat-icon>
    {{ getTitle() }}
  </h2>

  <mat-dialog-content>
    <form class="expense-form" #expenseForm="ngForm">
      
      <!-- Bolsillo -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Bolsillo</mat-label>
        <mat-select [(ngModel)]="formData.pocket_id" 
                    name="pocket_id" 
                    required>
          <mat-option *ngFor="let pocket of data.availablePockets" [value]="pocket.id">
            {{ pocket.name }}
          </mat-option>
        </mat-select>
        <mat-hint>Selecciona la categoría del gasto</mat-hint>
      </mat-form-field>

      <!-- Tipo de Gasto -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Tipo de Gasto</mat-label>
        <mat-select [(ngModel)]="formData.expense_type" 
                    name="expense_type" 
                    required
                    (selectionChange)="onExpenseTypeChange()">
          <mat-option value="fixed">Gasto Fijo</mat-option>
          <mat-option value="hybrid">Gasto Híbrido (Presupuesto Variable)</mat-option>
        </mat-select>
        <mat-hint>{{ getExpenseTypeHint() }}</mat-hint>
      </mat-form-field>

      <!-- Concepto -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Concepto</mat-label>
        <input matInput 
               [(ngModel)]="formData.concept_name"
               name="concept_name"
               placeholder="Ej: Arriendo, Servicios públicos, Gasolina..."
               required>
        <mat-hint>Describe el gasto específico</mat-hint>
      </mat-form-field>

      <!-- Campos para Gasto Fijo -->
      <div *ngIf="formData.expense_type === 'fixed'" class="form-row">
        <mat-form-field appearance="outline" class="flex-1">
          <mat-label>Monto Fijo</mat-label>
          <input matInput 
                 type="number" 
                 [(ngModel)]="formData.amount"
                 name="amount"
                 placeholder="0"
                 min="1"
                 required>
          <span matTextPrefix>$</span>
          <mat-hint>Valor fijo mensual</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="flex-1">
          <mat-label>Día de Pago</mat-label>
          <input matInput 
                 type="number" 
                 [(ngModel)]="formData.payment_day"
                 name="payment_day"
                 min="1" 
                 max="31"
                 placeholder="1"
                 required>
          <mat-hint>Día del mes (1-31)</mat-hint>
        </mat-form-field>
      </div>

      <!-- Campos para Gasto Híbrido -->
      <div *ngIf="formData.expense_type === 'hybrid'">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Presupuesto Mensual</mat-label>
          <input matInput 
                 type="number" 
                 [(ngModel)]="formData.budget_limit"
                 name="budget_limit"
                 placeholder="0"
                 min="1"
                 required>
          <span matTextPrefix>$</span>
          <mat-hint>Límite de presupuesto para el mes</mat-hint>
        </mat-form-field>
        
        <div class="hybrid-info-card">
          <mat-icon color="primary">info</mat-icon>
          <div class="info-content">
            <p><strong>Gasto Híbrido:</strong></p>
            <p>Podrás registrar múltiples transacciones durante el mes hasta alcanzar tu presupuesto límite.</p>
          </div>
        </div>
      </div>

      <!-- Validation Errors -->
      <div *ngIf="getValidationErrors().length > 0" class="validation-errors">
        <mat-icon color="warn">warning</mat-icon>
        <div class="error-list">
          <p *ngFor="let error of getValidationErrors()" class="error-message">
            {{ error }}
          </p>
        </div>
      </div>

    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" class="cancel-button">
      <mat-icon>cancel</mat-icon>
      Cancelar
    </button>
    
    <button mat-raised-button 
            color="primary" 
            (click)="onSave()"
            [disabled]="!isFormValid()"
            class="save-button">
      <mat-icon>{{ getSaveButtonIcon() }}</mat-icon>
      {{ getSaveButtonText() }}
    </button>
  </mat-dialog-actions>
</div>